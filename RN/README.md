‚úÖ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏£‡∏±‡∏ô React Native ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö

‡πÄ‡∏õ‡∏¥‡∏î Metro (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß):

npx react-native start --port 9090


‡∏≠‡∏µ‡∏Å terminal:

npx react-native run-android --port 9090


-----------------------


‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏ó‡∏≥ react-native 

‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡πÄ‡∏õ‡πâ‡∏ô project ‡πÄ‡∏û‡∏∑‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°

‡∏Å‡∏£‡∏ì‡∏µ ‡πÉ‡∏ä‡πâ react-native ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ sync update ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ sync ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‡πÄ‡∏ä‡πà‡∏ô 100000 ‡πÄ‡∏û‡∏∑‡∏≠‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ó‡∏µ‡πÄ‡∏ö‡∏≠ scammer ‡πÇ‡∏ó‡∏£‡πÄ‡∏Ç‡πâ‡∏≤

‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡πÄ‡∏ö‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏ï‡∏≠‡∏ô install ‡πÄ‡∏™‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î app ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏Å‡∏£‡∏ì‡∏µ
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö local table ‡πÄ‡∏Å‡πâ‡∏ö‡∏ß‡πà‡∏≤ ‡πÄ‡∏£‡∏≤ sync ‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô/‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏° ‡∏ï‡πâ‡∏≠‡∏á update ‡∏ï‡∏≠‡∏ô‡πÑ‡∏´‡∏ô last update ‡πÑ‡∏´‡∏°
- ‡πÄ‡∏ö‡∏≠‡∏ô‡∏±‡πâ‡∏ô‡πÜ‡πÜ ‡∏≠‡∏≤‡∏à‡∏°‡∏µ message ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ add message ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
- ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏ä‡πá‡∏Å‡πÉ‡∏ô local storage ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏µ on server ‡πÄ‡∏£‡∏≤‡∏ï‡∏ß‡∏£‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á
- ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡πÄ‡∏ö‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏ï‡∏≠‡∏ô install ‡πÄ‡∏™‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î app ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô server ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ update ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á ‡∏Å‡∏±‡∏ö local stoage 
- ‡∏Ç‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á project ‡∏ó‡∏µ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ block ‡πÄ‡∏ö‡∏≠‡∏´‡∏ô‡πà‡∏≠‡∏¢ 

- ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏≥ qraphql ‡∏à‡∏≤‡∏Å ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô

Tool
- React-native
- GraphQL
- SQLite


‡πÇ‡∏≠‡πÄ‡∏Ñ ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏°‡∏≤‡∏Å üïµüèª‚Äç‚ôÇÔ∏èüìµ  ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á **‡∏ù‡∏±‡πà‡∏á GraphQL + ‡πÇ‡∏Ñ‡∏£‡∏á sync + React Native + SQLite + ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå** ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏¢

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°

* **Server**

  * PostgreSQL (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö)
  * GraphQL API
  * ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å:

    * `post_tel_numbers` (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏à‡πâ‡∏á)
    * `posts` (‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô / ‡πÄ‡∏Ñ‡∏™)
  * ‡πÄ‡∏û‡∏¥‡πà‡∏° field `version` / `updated_at` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ **delta sync**

* **Mobile App (React Native)**

  * SQLite local: ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå ~100k ‡πÄ‡∏ö‡∏≠‡∏£‡πå + meta sync
  * GraphQL client (Apollo) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
  * Native Android: `CallScreeningService` (‡∏´‡∏£‡∏∑‡∏≠ default dialer) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å call ‡πÅ‡∏ö‡∏ö real-time

    * ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏≤‡∏Å **SQLite local ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß
    * ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡πÅ‡∏ï‡πà‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏à‡πÑ‡∏õ‡∏ñ‡∏≤‡∏° server ‡πÅ‡∏•‡πâ‡∏ß sync ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á

---

## 2. ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö SQLite schema (‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)

### 2.1 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå scam

```sql
CREATE TABLE IF NOT EXISTS scam_phones (
  id                INTEGER PRIMARY KEY,       -- local row id
  phone_normalized  TEXT NOT NULL,             -- ‡πÄ‡∏ö‡∏≠‡∏£‡πå normalize (E.164 / ‡∏•‡∏ö‡∏Ç‡∏µ‡∏î/‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß)
  report_count      INTEGER NOT NULL DEFAULT 0,
  last_report_at    TEXT,                      -- ISO string
  risk_level        INTEGER NOT NULL DEFAULT 0, -- 0‚Äì100
  tags              TEXT,                      -- JSON string: ["loan","crypto",...]
  server_updated_at TEXT NOT NULL,             -- updated_at ‡∏à‡∏≤‡∏Å server
  server_deleted    INTEGER NOT NULL DEFAULT 0 -- 0 = ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô, 1 = ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß
);

CREATE INDEX IF NOT EXISTS idx_scam_phones_phone
  ON scam_phones (phone_normalized);

CREATE INDEX IF NOT EXISTS idx_scam_phones_risk
  ON scam_phones (risk_level DESC);
```

### 2.2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á message / note ‡∏ï‡πà‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå

```sql
CREATE TABLE IF NOT EXISTS scam_phone_notes (
  id               INTEGER PRIMARY KEY,
  phone_normalized TEXT NOT NULL,
  message          TEXT NOT NULL,
  created_at       TEXT NOT NULL,
  created_by       TEXT,          -- user id / device id ‡∏Å‡πá‡πÑ‡∏î‡πâ
  is_local_only    INTEGER NOT NULL DEFAULT 1  -- 1 = ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà sync ‡∏Ç‡∏∂‡πâ‡∏ô server
);

CREATE INDEX IF NOT EXISTS idx_notes_phone
  ON scam_phone_notes (phone_normalized);
```

### 2.3 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á sync state

```sql
CREATE TABLE IF NOT EXISTS sync_state (
  id                  INTEGER PRIMARY KEY CHECK (id = 1),
  last_full_sync_at   TEXT,    -- ISO string
  last_delta_sync_at  TEXT,
  last_version        BIGINT,  -- ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ version number
  local_rows          INTEGER  -- ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏ô local ‡∏ï‡∏≠‡∏ô sync ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
);

-- seed ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
INSERT OR IGNORE INTO sync_state (id, last_version, local_rows)
VALUES (1, 0, 0);
```

> ‡πÉ‡∏ä‡πâ `last_version` / `server_updated_at` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ **incremental sync** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î 100k ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

---

## 3. ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå sync

### 3.1 Initial sync ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡∏´‡∏•‡∏±‡∏á install / login)

1. call GraphQL: `scamPhonesSnapshot(cursor, limit)` ‡∏´‡∏£‡∏∑‡∏≠ `offset/limit`
2. ‡∏î‡∏∂‡∏á‡∏ó‡∏µ‡∏•‡∏∞ 500‚Äì2000 records ‡πÅ‡∏•‡πâ‡∏ß `INSERT OR REPLACE` ‡∏•‡∏á SQLite
3. ‡πÄ‡∏Å‡πá‡∏ö `last_version` ‡∏´‡∏£‡∏∑‡∏≠ `max(updated_at)` ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `sync_state`

Pseudo code (React Native):

```ts
// db.ts
import * as SQLite from 'expo-sqlite';
export const db = SQLite.openDatabase('scam-protect.db');

export function initDb() {
  db.transaction(tx => {
    tx.executeSql(/* CREATE TABLE ... ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */);
  });
}
```

```ts
// syncInitial.ts
import { gql, ApolloClient } from "@apollo/client";
import { db } from "./db";

const SYNC_SNAPSHOT = gql`
  query ScamPhonesSnapshot($cursor: String, $limit: Int!) {
    scamPhonesSnapshot(cursor: $cursor, limit: $limit) {
      cursor
      items {
        phone
        report_count
        last_report_at
        risk_level
        tags
        updated_at
        is_deleted
      }
    }
  }
`;

export async function initialSync(client: ApolloClient<any>) {
  let cursor: string | null = null;
  const limit = 1000;

  let total = 0;
  let maxUpdatedAt: string | null = null;

  while (true) {
    const { data } = await client.query({
      query: SYNC_SNAPSHOT,
      variables: { cursor, limit },
      fetchPolicy: "network-only",
    });

    const batch = data?.scamPhonesSnapshot?.items || [];
    if (!batch.length) break;

    // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQLite ‡πÅ‡∏ö‡∏ö transaction
    await new Promise<void>((resolve, reject) => {
      db.transaction(
        (tx) => {
          batch.forEach((row: any) => {
            const phone = normalizePhone(row.phone);
            tx.executeSql(
              `
              INSERT INTO scam_phones (
                phone_normalized, report_count, last_report_at,
                risk_level, tags, server_updated_at, server_deleted
              )
              VALUES (?, ?, ?, ?, ?, ?, ?)
              ON CONFLICT(phone_normalized) DO UPDATE SET
                report_count      = excluded.report_count,
                last_report_at    = excluded.last_report_at,
                risk_level        = excluded.risk_level,
                tags              = excluded.tags,
                server_updated_at = excluded.server_updated_at,
                server_deleted    = excluded.server_deleted;
              `,
              [
                phone,
                row.report_count,
                row.last_report_at,
                row.risk_level,
                JSON.stringify(row.tags || []),
                row.updated_at,
                row.is_deleted ? 1 : 0,
              ]
            );
          });
        },
        reject,
        resolve
      );
    });

    total += batch.length;
    maxUpdatedAt = batch.reduce(
      (max: string | null, r: any) =>
        !max || r.updated_at > max ? r.updated_at : max,
      maxUpdatedAt
    );

    cursor = data.scamPhonesSnapshot.cursor || null;
    if (!cursor) break;
  }

  if (maxUpdatedAt) {
    db.transaction(tx => {
      tx.executeSql(
        `UPDATE sync_state
         SET last_full_sync_at = ?, last_version = ?, local_rows = ?
         WHERE id = 1`,
        [new Date().toISOString(), maxUpdatedAt, total]
      );
    });
  }
}
```

### 3.2 Delta sync (server ‡∏°‡∏µ update ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤)

* ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏û / ‡∏ï‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å background / ‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á:

  * ‡∏≠‡πà‡∏≤‡∏ô `last_version` ‡∏à‡∏≤‡∏Å `sync_state`
  * call GraphQL `scamPhonesDelta(sinceVersion)` ‚Üí ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ rows ‡∏ó‡∏µ‡πà `updated_at > last_version`
  * ‡∏ó‡∏≥ UPSERT ‡πÅ‡∏•‡∏∞ update `sync_state.last_version`

---

## 4. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤

### 4.1 ‡∏ù‡∏±‡πà‡∏á Native Android (Kotlin + CallScreeningService)

> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ native ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô React Native ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á minimal:

```kotlin
class ScamCallScreeningService : CallScreeningService() {

    override fun onScreenCall(callDetails: Call.Details) {
        val phone = callDetails.handle.schemeSpecificPart  // ‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô string
        val normalized = normalizePhone(phone)

        val isScam = checkScamFromSQLite(normalized)

        val response = CallResponse.Builder()
            .setDisallowCall(isScam)
            .setRejectCall(isScam)
            .setSilenceCall(isScam)
            .setSkipCallLog(!isScam)     // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô scam ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏•‡∏á call log ‡∏Å‡πá‡πÑ‡∏î‡πâ
            .setSkipNotification(isScam)
            .build()

        respondToCall(callDetails, response)
    }

    private fun checkScamFromSQLite(phone: String): Boolean {
        // ‡πÄ‡∏õ‡∏¥‡∏î SQLite DB ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà React Native ‡πÉ‡∏ä‡πâ (path ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
        val db = SQLiteDatabase.openDatabase(
            "/data/data/your.package.name/databases/scam-protect.db",
            null,
            SQLiteDatabase.OPEN_READONLY
        )

        val cursor = db.rawQuery(
            "SELECT risk_level FROM scam_phones WHERE phone_normalized = ? AND server_deleted = 0 LIMIT 1",
            arrayOf(phone)
        )

        var risk = 0
        if (cursor.moveToFirst()) {
            risk = cursor.getInt(0)
        }
        cursor.close()
        db.close()
        return risk >= 50   // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î threshold ‡∏ó‡∏µ‡πà‡∏à‡∏∞ block
    }
}
```

‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á service ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô `AndroidManifest.xml` ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ user ‡∏Å‡∏≥‡∏´‡∏ô‡∏î app ‡πÄ‡∏õ‡πá‡∏ô **Call screening app** / default caller ID & spam app

### 4.2 ‡∏ù‡∏±‡πà‡∏á React Native (utility ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô UI + debug call)

```ts
// db-utils.ts
export function checkScamPhone(phone: string): Promise<{ found: boolean; risk: number }> {
  const normalized = normalizePhone(phone);
  return new Promise((resolve, reject) => {
    db.readTransaction(
      tx => {
        tx.executeSql(
          `SELECT risk_level FROM scam_phones
           WHERE phone_normalized = ? AND server_deleted = 0
           LIMIT 1`,
          [normalized],
          (_, result) => {
            if (result.rows.length) {
              const row = result.rows.item(0);
              resolve({ found: true, risk: row.risk_level });
            } else {
              resolve({ found: false, risk: 0 });
            }
          }
        );
      },
      reject
    );
  });
}
```

‡πÄ‡∏ß‡∏•‡∏≤ user ‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏ô app ‡∏Å‡πá‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ + ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏≠‡∏¢‡∏¢‡∏¥‡∏á GraphQL `globalSearch` ‡πÅ‡∏•‡πâ‡∏ß cache ‡∏•‡∏á local ‡∏ï‡πà‡∏≠

---

## 5. ‡∏Å‡∏£‡∏ì‡∏µ *local ‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÅ‡∏ï‡πà server ‡∏°‡∏µ*

‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÑ‡∏°‡πà block call ‡∏ä‡πâ‡∏≤):

1. **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å local ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ block ‡∏Ç‡∏ì‡∏∞‡∏™‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤
2. ‡∏ñ‡πâ‡∏≤ **‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ local**:

   * ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà block)
   * ‡πÉ‡∏ô background (React Native side / native worker) ‡∏≠‡∏≤‡∏à‡∏¢‡∏¥‡∏á GraphQL `globalSearch` ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏±‡πâ‡∏ô
   * ‡∏ñ‡πâ‡∏≤ server ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô scam ‚Üí

     * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á SQLite
     * ‡πÅ‡∏™‡∏î‡∏á in-app notification ‡∏ß‡πà‡∏≤ ‚Äú‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß xx ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‚Äù
     * ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ñ‡πâ‡∏≤‡πÇ‡∏ó‡∏£‡∏°‡∏≤ ‡∏à‡∏∞‡πÇ‡∏î‡∏ô block ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô local ‡πÅ‡∏•‡πâ‡∏ß

---

## 6. ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á GraphQL schema (‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö)

‡∏™‡∏°‡∏°‡∏ï‡∏¥ backend ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á:

* `post_tel_numbers (id, post_id, tel, created_at, ...)`
* `posts (id, title, detail, ...)`

‡πÄ‡∏£‡∏≤‡∏ó‡∏≥ type ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile sync ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

```graphql
# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏£‡∏∏‡∏õ
type ScamPhone {
  phone: String!
  report_count: Int!
  last_report_at: String
  risk_level: Int!        # 0-100, ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å report_count / weight ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
  tags: [String!]!
  updated_at: String!     # iso time, ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync
  is_deleted: Boolean!
  post_ids: [ID!]!        # post ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
}

type ScamPhoneSnapshotPage {
  cursor: String
  items: [ScamPhone!]!
}

type ScamPhoneDeltaPage {
  cursor: String
  items: [ScamPhone!]!
}

type Query {
  # ‡πÉ‡∏ä‡πâ initial sync
  scamPhonesSnapshot(cursor: String, limit: Int! = 1000): ScamPhoneSnapshotPage!

  # ‡πÉ‡∏ä‡πâ delta sync
  scamPhonesDelta(sinceVersion: String!, cursor: String, limit: Int! = 1000): ScamPhoneDeltaPage!

  # ‡πÉ‡∏ä‡πâ manual search (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô globalSearch ‡πÅ‡∏ï‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå)
  searchScamPhones(q: String!, limit: Int! = 20): [ScamPhone!]!
}
```

Resolver (concept):

```ts
// pseudo-code (Node + pg)
async function scamPhonesSnapshot(_, { cursor, limit }, ctx) {
  // cursor ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô last id ‡∏´‡∏£‡∏∑‡∏≠ last updated_at ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ
  const { rows } = await ctx.pg.query(
    `
    SELECT
      tel,
      COUNT(*) AS report_count,
      MAX(created_at) AS last_report_at,
      MAX(updated_at) AS updated_at,
      bool_or(is_deleted) AS is_deleted,
      ARRAY_AGG(DISTINCT post_id) AS post_ids
    FROM post_tel_numbers
    WHERE updated_at > $1
    GROUP BY tel
    ORDER BY updated_at ASC
    LIMIT $2
    `,
    [cursor || '1970-01-01', limit]
  );

  const items = rows.map(r => ({
    phone: r.tel,
    report_count: r.report_count,
    last_report_at: r.last_report_at,
    risk_level: calcRisk(r.report_count),
    tags: [],       // ‡∏à‡∏∞‡πÉ‡∏™‡πà "loan","marketplace" ‡∏Å‡πá‡πÑ‡∏î‡πâ
    updated_at: r.updated_at,
    is_deleted: r.is_deleted,
    post_ids: r.post_ids,
  }));

  const nextCursor = rows.length ? rows[rows.length - 1].updated_at : null;

  return { cursor: nextCursor, items };
}
```

> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö delta sync ‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô condition ‡πÄ‡∏õ‡πá‡∏ô `updated_at > sinceVersion` ‡∏Å‡πá‡πÑ‡∏î‡πâ

---

## 7. ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á React Native UI (‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö manual)

```tsx
// CheckPhoneScreen.tsx
import React, { useState } from "react";
import { View } from "react-native";
import { Input, Button, Text } from "react-native-elements";
import { checkScamPhone } from "../db-utils";

export default function CheckPhoneScreen() {
  const [phone, setPhone] = useState("");
  const [result, setResult] = useState<{found:boolean; risk:number} | null>(null);

  const onCheck = async () => {
    const res = await checkScamPhone(phone);
    setResult(res);
  };

  return (
    <View style={{ flex: 1, padding: 16 }}>
      <Input
        placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"
        keyboardType="phone-pad"
        value={phone}
        onChangeText={setPhone}
      />
      <Button title="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå" onPress={onCheck} />

      {result && (
        <View style={{ marginTop: 16 }}>
          {result.found ? (
            <>
              <Text style={{ color: "red", fontWeight: "bold" }}>
                ‡∏û‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (risk {result.risk}/100)
              </Text>
              {result.risk >= 50 && (
                <Text>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏•‡πá‡∏≠‡∏Å / ‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢</Text>
              )}
            </>
          ) : (
            <Text>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</Text>
          )}
        </View>
      )}
    </View>
  );
}
```

---

## 8. ‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå bullet ‡∏ó‡∏µ‡πà‡∏ñ‡∏≤‡∏°‡∏°‡∏≤

* ‚úÖ **local table ‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡πà‡∏≤ sync ‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô / ‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏° / last update**
  ‚Üí ‡πÉ‡∏ä‡πâ `sync_state` (‡∏°‡∏µ `last_full_sync_at`, `last_delta_sync_at`, `last_version`, `local_rows`)

* ‚úÖ **‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏µ message / add message ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ**
  ‚Üí ‡πÉ‡∏ä‡πâ `scam_phone_notes` ‡∏ú‡∏π‡∏Å `phone_normalized` ‡∏Å‡∏±‡∏ö note, sync ‡∏Ç‡∏∂‡πâ‡∏ô server ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ

* ‚úÖ **‡πÄ‡∏ä‡πá‡∏Å local ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ö‡∏ô server**

  * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö block real-time: ‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πà‡∏á server (‡∏Å‡∏±‡∏ô‡∏ä‡πâ‡∏≤)
  * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö manual check: ‡∏ñ‡πâ‡∏≤ local ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡∏¢‡∏¥‡∏á GraphQL `searchScamPhones` + `globalSearch` ‡πÅ‡∏•‡πâ‡∏ß cache ‡∏•‡∏á SQLite ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡πá‡∏ß

* ‚úÖ **‡∏î‡∏∂‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≠‡∏ô install ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å**
  ‚Üí initial sync (‡∏Ç‡πâ‡∏≠ 3.1) ‡∏î‡∏∂‡∏á‡∏ó‡∏µ‡∏•‡∏∞ batch 1000 ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQLite

* ‚úÖ **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô server update ‡∏ï‡∏•‡∏≠‡∏î**
  ‚Üí delta sync (‡∏Ç‡πâ‡∏≠ 3.2) ‡∏ï‡∏≤‡∏° `updated_at` / `version`

* ‚úÖ **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á project block ‡πÄ‡∏ö‡∏≠‡∏£‡πå**

  * React Native app + SQLite (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
  * Android `CallScreeningService` ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Kotlin + query SQLite (‡∏Ç‡πâ‡∏≠ 4.1)
  * iOS ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ CallKit + Call Directory extension) ‡πÅ‡∏ï‡πà concept ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô

* ‚úÖ **GraphQL ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô**
  ‚Üí ‡πÉ‡∏ä‡πâ `ScamPhone` + `scamPhonesSnapshot` + `scamPhonesDelta` + `searchScamPhones` (‡∏Ç‡πâ‡∏≠ 6)

---

‡∏ñ‡πâ‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÜ** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö React Native (‡πÄ‡∏ä‡πà‡∏ô `db.ts`, `sync.ts`, `CheckPhoneScreen.tsx`) ‡πÅ‡∏ö‡∏ö copy ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô structure ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ üëç




‡∏à‡∏±‡∏î‡∏°‡∏≤‡πÄ‡∏•‡∏¢‡∏™‡∏¥ AI ‡∏à‡∏∞‡∏£‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ +

‡∏ñ‡πâ‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö React Native (‡πÄ‡∏ä‡πà‡∏ô db.ts, sync.ts, CheckPhoneScreen.tsx) ‡πÅ‡∏ö‡∏ö copy ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô structure ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ üëç

‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏Ñ‡∏£‡∏á project ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üí™

‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RN + Expo + Apollo + SQLite

---

## 0. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

```txt
src/
  lib/
    db.ts
    normalizePhone.ts
    syncScamPhones.ts
  apollo/
    client.ts
  screens/
    CheckPhoneScreen.tsx
  hooks/
    useInitScamSync.ts
App.tsx
```

---

## 1. `src/lib/db.ts` ‚Äì ‡πÄ‡∏õ‡∏¥‡∏î DB + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á

```ts
// src/lib/db.ts
import * as SQLite from "expo-sqlite";

export const DB_NAME = "scam-protect.db";

// expo-sqlite v11+
export const db = SQLite.openDatabaseSync(DB_NAME);

// helper ‡∏£‡∏±‡∏ô SQL ‡πÅ‡∏ö‡∏ö promise
export function runAsync<T = any>(
  sql: string,
  params: any[] = []
): Promise<SQLite.SQLResultSet> {
  return db.execAsync([{ sql, args: params }], false).then((res) => res[0]);
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πà‡∏≤‡∏á ‡πÜ
export async function initDb() {
  // scam_phones
  await runAsync(`
    CREATE TABLE IF NOT EXISTS scam_phones (
      id                INTEGER PRIMARY KEY AUTOINCREMENT,
      phone_normalized  TEXT NOT NULL UNIQUE,
      report_count      INTEGER NOT NULL DEFAULT 0,
      last_report_at    TEXT,
      risk_level        INTEGER NOT NULL DEFAULT 0,
      tags              TEXT,
      server_updated_at TEXT NOT NULL,
      server_deleted    INTEGER NOT NULL DEFAULT 0
    );
  `);

  await runAsync(`
    CREATE INDEX IF NOT EXISTS idx_scam_phones_phone
    ON scam_phones(phone_normalized);
  `);

  await runAsync(`
    CREATE INDEX IF NOT EXISTS idx_scam_phones_risk
    ON scam_phones(risk_level DESC);
  `);

  // notes
  await runAsync(`
    CREATE TABLE IF NOT EXISTS scam_phone_notes (
      id               INTEGER PRIMARY KEY AUTOINCREMENT,
      phone_normalized TEXT NOT NULL,
      message          TEXT NOT NULL,
      created_at       TEXT NOT NULL,
      created_by       TEXT,
      is_local_only    INTEGER NOT NULL DEFAULT 1
    );
  `);

  await runAsync(`
    CREATE INDEX IF NOT EXISTS idx_notes_phone
    ON scam_phone_notes(phone_normalized);
  `);

  // sync_state ‚Äì ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 1 row
  await runAsync(`
    CREATE TABLE IF NOT EXISTS sync_state (
      id                 INTEGER PRIMARY KEY CHECK (id = 1),
      last_full_sync_at  TEXT,
      last_delta_sync_at TEXT,
      last_version       TEXT,
      local_rows         INTEGER
    );
  `);

  // seed ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å
  await runAsync(
    `
    INSERT OR IGNORE INTO sync_state (id, last_version, local_rows)
    VALUES (1, '0', 0);
  `
  );
}
```

> ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ expo-sqlite ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ `openDatabaseSync/execAsync` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô callback-based ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á Expo SDK 51+

---

## 2. `src/lib/normalizePhone.ts` ‚Äì ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô normalize ‡πÄ‡∏ö‡∏≠‡∏£‡πå

```ts
// src/lib/normalizePhone.ts

// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢: ‡πÅ‡∏õ‡∏•‡∏á 0xxxxxxxxx -> +66xxxxxxxxx
export function normalizePhone(raw: string): string {
  if (!raw) return "";
  let s = raw.replace(/[^\d+]/g, ""); // ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏±‡∏ö +

  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ + ‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏•‡∏¢
  if (s.startsWith("+")) return s;

  // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢ 0 ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß 10 ‡∏´‡∏•‡∏±‡∏Å -> +66
  if (s.startsWith("0") && s.length >= 9) {
    return "+66" + s.slice(1);
  }

  // ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡πá‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏•‡∏Ç‡πÄ‡∏â‡∏¢ ‡πÜ
  return s;
}
```

---

## 3. `src/lib/syncScamPhones.ts` ‚Äì initial sync + delta sync + check local

```ts
// src/lib/syncScamPhones.ts
import { gql, ApolloClient, NormalizedCacheObject } from "@apollo/client";
import { db, runAsync } from "./db";
import { normalizePhone } from "./normalizePhone";

// ===== GraphQL =====

export const Q_SCAM_PHONES_SNAPSHOT = gql`
  query ScamPhonesSnapshot($cursor: String, $limit: Int!) {
    scamPhonesSnapshot(cursor: $cursor, limit: $limit) {
      cursor
      items {
        phone
        report_count
        last_report_at
        risk_level
        tags
        updated_at
        is_deleted
        post_ids
      }
    }
  }
`;

export const Q_SCAM_PHONES_DELTA = gql`
  query ScamPhonesDelta($sinceVersion: String!, $cursor: String, $limit: Int!) {
    scamPhonesDelta(
      sinceVersion: $sinceVersion
      cursor: $cursor
      limit: $limit
    ) {
      cursor
      items {
        phone
        report_count
        last_report_at
        risk_level
        tags
        updated_at
        is_deleted
        post_ids
      }
    }
  }
`;

// =====================
// helper: upsert 1 batch
// =====================
async function upsertBatch(items: any[]) {
  if (!items.length) return;

  await db.withTransactionAsync(async () => {
    for (const row of items) {
      const phone = normalizePhone(row.phone);

      await runAsync(
        `
        INSERT INTO scam_phones (
          phone_normalized,
          report_count,
          last_report_at,
          risk_level,
          tags,
          server_updated_at,
          server_deleted
        ) VALUES (?, ?, ?, ?, ?, ?, ?)
        ON CONFLICT(phone_normalized) DO UPDATE SET
          report_count      = excluded.report_count,
          last_report_at    = excluded.last_report_at,
          risk_level        = excluded.risk_level,
          tags              = excluded.tags,
          server_updated_at = excluded.server_updated_at,
          server_deleted    = excluded.server_deleted;
      `,
        [
          phone,
          row.report_count ?? 0,
          row.last_report_at ?? null,
          row.risk_level ?? 0,
          JSON.stringify(row.tags ?? []),
          row.updated_at,
          row.is_deleted ? 1 : 0,
        ]
      );
    }
  });
}

// =====================
// Initial sync (snapshot)
// =====================
export async function initialScamSync(
  client: ApolloClient<NormalizedCacheObject>,
  batchSize = 1000
) {
  let cursor: string | null = null;
  let maxVersion: string | null = null;
  let total = 0;

  while (true) {
    const { data } = await client.query({
      query: Q_SCAM_PHONES_SNAPSHOT,
      variables: { cursor, limit: batchSize },
      fetchPolicy: "network-only",
    });

    const page = data?.scamPhonesSnapshot;
    const items = page?.items ?? [];
    if (!items.length) break;

    await upsertBatch(items);

    total += items.length;
    for (const it of items) {
      if (!maxVersion || it.updated_at > maxVersion) {
        maxVersion = it.updated_at;
      }
    }

    cursor = page.cursor || null;
    if (!cursor) break;
  }

  if (maxVersion) {
    await runAsync(
      `
      UPDATE sync_state
      SET last_full_sync_at = ?, last_version = ?, local_rows = ?
      WHERE id = 1;
    `,
      [new Date().toISOString(), maxVersion, total]
    );
  }
}

// =====================
// Delta sync
// =====================
async function getLastVersion(): Promise<string> {
  const res = await runAsync(`SELECT last_version FROM sync_state WHERE id = 1;`);
  if (res.rows.length) {
    const v = (res.rows as any)._array?.[0]?.last_version ?? res.rows.item(0).last_version;
    return v || "0";
  }
  return "0";
}

export async function deltaScamSync(
  client: ApolloClient<NormalizedCacheObject>,
  batchSize = 1000
) {
  const sinceVersion = await getLastVersion();
  let cursor: string | null = null;
  let maxVersion: string | null = sinceVersion;

  while (true) {
    const { data } = await client.query({
      query: Q_SCAM_PHONES_DELTA,
      variables: { sinceVersion, cursor, limit: batchSize },
      fetchPolicy: "network-only",
    });

    const page = data?.scamPhonesDelta;
    const items = page?.items ?? [];
    if (!items.length) break;

    await upsertBatch(items);

    for (const it of items) {
      if (!maxVersion || it.updated_at > maxVersion) {
        maxVersion = it.updated_at;
      }
    }

    cursor = page.cursor || null;
    if (!cursor) break;
  }

  if (maxVersion && maxVersion !== sinceVersion) {
    await runAsync(
      `
      UPDATE sync_state
      SET last_delta_sync_at = ?, last_version = ?
      WHERE id = 1;
    `,
      [new Date().toISOString(), maxVersion]
    );
  }
}

// =====================
// ‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å local (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô UI + native)
// =====================
export async function checkScamPhoneLocal(phoneRaw: string): Promise<{
  found: boolean;
  risk: number;
  reportCount: number;
}> {
  const phone = normalizePhone(phoneRaw);
  const res = await runAsync(
    `
    SELECT risk_level, report_count
    FROM scam_phones
    WHERE phone_normalized = ? AND server_deleted = 0
    LIMIT 1;
  `,
    [phone]
  );

  if (res.rows.length) {
    const row =
      (res.rows as any)._array?.[0] ?? res.rows.item(0);
    return {
      found: true,
      risk: row.risk_level ?? 0,
      reportCount: row.report_count ?? 0,
    };
  }

  return { found: false, risk: 0, reportCount: 0 };
}
```

---

## 4. `src/apollo/client.ts` ‚Äì Apollo client (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏±‡πâ‡∏ô‡πÜ)

```ts
// src/apollo/client.ts
import { ApolloClient, InMemoryCache, HttpLink } from "@apollo/client";

export const apolloClient = new ApolloClient({
  link: new HttpLink({
    uri: "https://your-api.example.com/graphql",
  }),
  cache: new InMemoryCache(),
});
```

---

## 5. `src/hooks/useInitScamSync.ts` ‚Äì hook ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å init + sync

```ts
// src/hooks/useInitScamSync.ts
import { useEffect, useState } from "react";
import { apolloClient } from "../apollo/client";
import { initDb } from "../lib/db";
import { initialScamSync, deltaScamSync } from "../lib/syncScamPhones";

export function useInitScamSync() {
  const [ready, setReady] = useState(false);
  const [syncing, setSyncing] = useState(false);

  useEffect(() => {
    (async () => {
      try {
        await initDb();
        setSyncing(true);

        // ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏•‡∏≠‡∏á initial ‡∏Å‡πà‡∏≠‡∏ô (‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ flag ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∂‡∏¢‡∏±‡∏á)
        await initialScamSync(apolloClient, 1000);

        // ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏û‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÜ ‡πÑ‡∏õ‡∏à‡∏∞‡πÉ‡∏ä‡πâ delta ‡πÅ‡∏ó‡∏ô
        await deltaScamSync(apolloClient, 1000);
      } catch (e) {
        console.warn("[ScamSync] error", e);
      } finally {
        setSyncing(false);
        setReady(true);
      }
    })();
  }, []);

  return { ready, syncing };
}
```

---

## 6. `src/screens/CheckPhoneScreen.tsx` ‚Äì ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå

```tsx
// src/screens/CheckPhoneScreen.tsx
import React, { useState } from "react";
import {
  View,
  Text,
  TextInput,
  Pressable,
  ActivityIndicator,
  StyleSheet,
} from "react-native";
import { checkScamPhoneLocal } from "../lib/syncScamPhones";

export default function CheckPhoneScreen() {
  const [phone, setPhone] = useState("");
  const [result, setResult] = useState<{
    found: boolean;
    risk: number;
    reportCount: number;
  } | null>(null);
  const [loading, setLoading] = useState(false);

  const onCheck = async () => {
    if (!phone.trim()) return;
    setLoading(true);
    try {
      const res = await checkScamPhoneLocal(phone);
      setResult(res);
    } finally {
      setLoading(false);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢</Text>

      <TextInput
        style={styles.input}
        placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÄ‡∏ä‡πà‡∏ô 0912345678"
        keyboardType="phone-pad"
        value={phone}
        onChangeText={setPhone}
      />

      <Pressable style={styles.button} onPress={onCheck}>
        <Text style={styles.buttonText}>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</Text>
      </Pressable>

      {loading && (
        <View style={{ marginTop: 16 }}>
          <ActivityIndicator />
        </View>
      )}

      {result && !loading && (
        <View style={{ marginTop: 24 }}>
          {result.found ? (
            <>
              <Text style={{ fontSize: 16, fontWeight: "600", color: "red" }}>
                ‚ö† ‡∏û‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </Text>
              <Text style={{ marginTop: 8 }}>
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: {result.risk}/100
              </Text>
              <Text>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏à‡πâ‡∏á: {result.reportCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</Text>
              {result.risk >= 50 && (
                <Text style={{ marginTop: 4, color: "red" }}>
                  ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ß‡∏±‡∏á / ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢ / ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
                </Text>
              )}
            </>
          ) : (
            <Text style={{ fontSize: 16 }}>
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </Text>
          )}
        </View>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 16,
    paddingTop: 32,
    backgroundColor: "#fff",
  },
  title: {
    fontSize: 20,
    fontWeight: "700",
    marginBottom: 16,
  },
  input: {
    borderWidth: 1,
    borderColor: "#ddd",
    borderRadius: 8,
    paddingHorizontal: 12,
    paddingVertical: 10,
    fontSize: 16,
  },
  button: {
    marginTop: 12,
    backgroundColor: "#1677ff",
    borderRadius: 8,
    paddingVertical: 10,
    alignItems: "center",
  },
  buttonText: {
    color: "#fff",
    fontWeight: "600",
    fontSize: 16,
  },
});
```

---

## 7. ‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô `App.tsx`

```tsx
// App.tsx
import React from "react";
import { SafeAreaView, StatusBar, ActivityIndicator, View, Text } from "react-native";
import { ApolloProvider } from "@apollo/client";
import { apolloClient } from "./src/apollo/client";
import { useInitScamSync } from "./src/hooks/useInitScamSync";
import CheckPhoneScreen from "./src/screens/CheckPhoneScreen";

function Root() {
  const { ready, syncing } = useInitScamSync();

  if (!ready) {
    return (
      <View style={{ flex: 1, justifyContent: "center", alignItems: "center" }}>
        <ActivityIndicator />
        <Text style={{ marginTop: 8 }}>
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á...
        </Text>
      </View>
    );
  }

  return (
    <SafeAreaView style={{ flex: 1 }}>
      <StatusBar barStyle="dark-content" />
      <CheckPhoneScreen />
    </SafeAreaView>
  );
}

export default function App() {
  return (
    <ApolloProvider client={apolloClient}>
      <Root />
    </ApolloProvider>
  );
}
```

---

‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ ‚Äú‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏Å‚Äù ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö

* ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ‚Üí init SQLite + initial sync + delta sync
* ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å local
* ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö **CallScreeningService** ‡∏ù‡∏±‡πà‡∏á Android ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á

‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ù‡∏±‡πà‡∏á **Kotlin CallScreeningService + ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå DB path ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á RN ‡∏Å‡∏±‡∏ö Native** ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ï‡πá‡∏° ‡πÜ ‡∏≠‡∏µ‡∏Å‡πÄ‡∏ã‡πá‡∏ï ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏ú‡∏°‡∏à‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô `ScamCallScreeningService.kt` + ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á `AndroidManifest.xml` ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö üëå

